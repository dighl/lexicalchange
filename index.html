<html>
<head>
  <title>Lexical Change Viewer</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <script src="main.js" type="text/javascript"></script>
  <style>
li.node:before {
	content: "\25B6 ";
	margin-right: 20px;

}

li.node {
	list-style: none;
	margin-right: 20px;
	margin-left: 20px;
	list-style-position: outside;
	float: none;
	display: inline;
	cursor: pointer;

}
.leaf-wrap {
	border: 1px dashed red;
	display: table-cell;
	border-radius: 25px;
	padding: 10px;
	margin-left: 100px;

}
.leaf-element {
	display: table-row;
}
.leaf-content {
	display: table-cell;
}
.leaf-name {
	display: table-cell;
	width: 150px;
	border: 1px dotted lightgray;

}
.node-wrap {
	border: 1px dashed gray;
	display: table-cell;
	margin-left: 100px;
	border-radius: 25px;
	padding: 10px;
}
.node-content {
	display: table-cell;
}
.node-name {
	display: table-cell;
	cursor: pointer;
	margin-left: 10px;
	padding-left: 5px;
	width: 100px;
	border: 1px dotted lightgray;
}
.node-element {
	display: block;
	margin-bottom: 5px;
	margin-top: 5px;
}
.loss {
	border: 1px solid lightgray;
}

.loss:after {
	content: " Ø";
	margin-left: 5px;
}

.colors {
	display: table-cell;
	margin: 10px;
	padding: 10px;
	border: 2px solid lightgray;
	color: white;
	font-weight: bold;
}

  </style>
</head>
<body>
  <h1>Lexical Change Viewer (Powered by LingPy)</h1>
  <button style="background-color:Crimson" onclick="toggleWords()">TOGGLE</button>
  <select id="selector"> 
  <option value="a while">a while</option><option value="and">and</option><option value="aubergine">aubergine</option><option value="aunt (wife of father's elder brother)">aunt (wife of father's elder brother)</option><option value="aunt (wife of father's younger brother)">aunt (wife of father's younger brother)</option><option value="aunt (wife of mother's brother)">aunt (wife of mother's brother)</option><option value="become sick">become sick</option><option value="bedbug">bedbug</option><option value="beggar">beggar</option><option value="blow">blow</option><option value="boy">boy</option><option value="breakfast">breakfast</option><option value="broad bean">broad bean</option><option value="cabbage">cabbage</option><option value="catch a cold">catch a cold</option><option value="cheap">cheap</option><option value="chicken">chicken</option><option value="chimney">chimney</option><option value="chopsticks">chopsticks</option><option value="classifier (cow)">classifier (cow)</option><option value="classifier (pair)">classifier (pair)</option><option value="classifier (person)">classifier (person)</option><option value="classifier (pig)">classifier (pig)</option><option value="classifier (pillow)">classifier (pillow)</option><option value="classifier (vehicle)">classifier (vehicle)</option><option value="clean">clean</option><option value="cold">cold</option><option value="cook">cook</option><option value="daughter">daughter</option><option value="die">die</option><option value="dirty">dirty</option><option value="doctor">doctor</option><option value="doorsills">doorsills</option><option value="Dragon Boat Festival">Dragon Boat Festival</option><option value="dumpling won ton (Huntun)">dumpling won ton (Huntun)</option><option value="eight">eight</option><option value="eleven">eleven</option><option value="face">face</option><option value="fat">fat</option><option value="father">father</option><option value="female pig">female pig</option><option value="fingernail">fingernail</option><option value="first">first</option><option value="fist">fist</option><option value="five">five</option><option value="flat">flat</option><option value="forefinger">forefinger</option><option value="forehead">forehead</option><option value="four">four</option><option value="freeze">freeze</option><option value="from">from</option><option value="girl">girl</option><option value="go to the doctor">go to the doctor</option><option value="grandfather">grandfather</option><option value="grandmother">grandmother</option><option value="hail">hail</option><option value="have diarrhoea">have diarrhoea</option><option value="he">he</option><option value="head">head</option><option value="here">here</option><option value="hot">hot</option><option value="house">house</option><option value="how">how</option><option value="humpback">humpback</option><option value="husband">husband</option><option value="I">I</option><option value="in the middle">in the middle</option><option value="inside">inside</option><option value="instead of">instead of</option><option value="just (just appropriate)">just (just appropriate)</option><option value="just (just came)">just (just came)</option><option value="just right">just right</option><option value="kitchen">kitchen</option><option value="knee">knee</option><option value="lame person">lame person</option><option value="last year">last year</option><option value="left">left</option><option value="left hand">left hand</option><option value="leg">leg</option><option value="light">light</option><option value="lightning">lightning</option><option value="long">long</option><option value="lunch">lunch</option><option value="male pig">male pig</option><option value="man">man</option><option value="maternal grandfather">maternal grandfather</option><option value="maternal grandmother">maternal grandmother</option><option value="Mid-autumn Festival">Mid-autumn Festival</option><option value="moon">moon</option><option value="mother">mother</option><option value="mouse">mouse</option><option value="neck">neck</option><option value="New Year's Eve">New Year's Eve</option><option value="next year">next year</option><option value="nine">nine</option><option value="noodles">noodles</option><option value="nose">nose</option><option value="nurse">nurse</option><option value="old man">old man</option><option value="on">on</option><option value="on purpose">on purpose</option><option value="one">one</option><option value="one time">one time</option><option value="only">only</option><option value="outside">outside</option><option value="pig">pig</option><option value="potato">potato</option><option value="pumpkin">pumpkin</option><option value="rain">rain</option><option value="rainbow">rainbow</option><option value="right">right</option><option value="right hand">right hand</option><option value="rooster">rooster</option><option value="salt">salt</option><option value="salty">salty</option><option value="second">second</option><option value="self">self</option><option value="seven">seven</option><option value="short">short</option><option value="six">six</option><option value="snow">snow</option><option value="son">son</option><option value="sour">sour</option><option value="soya sauce">soya sauce</option><option value="sparrow">sparrow</option><option value="spinach">spinach</option><option value="spoon">spoon</option><option value="stairs">stairs</option><option value="star">star</option><option value="steamed bun (Mantou)">steamed bun (Mantou)</option><option value="steamed stuffed bun (Baozi)">steamed stuffed bun (Baozi)</option><option value="stinky">stinky</option><option value="sun">sun</option><option value="sunday">sunday</option><option value="sunflower">sunflower</option><option value="supper">supper</option><option value="sweet">sweet</option><option value="sweet potato">sweet potato</option><option value="table">table</option><option value="take">take</option><option value="ten">ten</option><option value="that">that</option><option value="there">there</option><option value="they">they</option><option value="thick">thick</option><option value="thin">thin</option><option value="this">this</option><option value="this year">this year</option><option value="thou">thou</option><option value="three">three</option><option value="thunder">thunder</option><option value="tiny">tiny</option><option value="today">today</option><option value="toilet">toilet</option><option value="tomato">tomato</option><option value="tomorrow">tomorrow</option><option value="twelve">twelve</option><option value="twenty">twenty</option><option value="twenty one">twenty one</option><option value="two">two</option><option value="two miles">two miles</option><option value="two ounces">two ounces</option><option value="uncle (father's younger brother)">uncle (father's younger brother)</option><option value="uncle (fathers's elder brother)">uncle (fathers's elder brother)</option><option value="uncle (mother's brother)">uncle (mother's brother)</option><option value="under">under</option><option value="vinegar">vinegar</option><option value="we">we</option><option value="we (inclusive)">we (inclusive)</option><option value="well smelling">well smelling</option><option value="what">what</option><option value="what kind of">what kind of</option><option value="wheat">wheat</option><option value="where">where</option><option value="who">who</option><option value="wife">wife</option><option value="window">window</option><option value="woman">woman</option><option value="yesterday">yesterday</option><option value="you">you</option>
  </select>
  <button onclick="loadConcept()">SUBMIT</button>
  <h2 id="header"></h2>
  <div id="colors"></div>


  <div id="display"></div>

  <script>
var DATA = {};
DATA['settings'] = 'words';

function toggleWords() {
  if (DATA['settings'] == 'words') {DATA['settings'] = '';} else
    {DATA['settings'] = 'words'; console.log(DATA['settings']);}
}

function loadConcept() {

  var concept = '';
  var selection = document.getElementById('selector');
  for (var i=0,sel; sel=selector.options[i]; i++) {
    if (sel.selected) {
      concept = sel.value;
      break;
    }
  }
  
  $.ajax({
   dataType: "json",
   async: false,
   url: 'json/'+concept+'.json',
   success: function(data){console.log('sucess');
     for (key in data) {
       DATA[key] = data[key];
     }}
  });
  
  
  var display = document.getElementById('display');
  
  var queue = DATA['order'];
  var txt = '<ul><li id="E_root" style="list-style:none">{root}</li></ul>';
  
  /* iterate over the queue */
  for (var i=0,name; name=queue[i]; i++) {
    var children = DATA[name]['children'];
    
    if (children.length >= 1) {
      if (DATA[name]['consensus'].length > 0) {
	var rep_string = '';
	rep_string += '<div class="node-wrap" onclick="modifyEdge(\''+name+'\');">';

      	for (var j=0,cns; cns=DATA[name]['consensus'][j]; j++) {
	  if (DATA[name]['retention'][j] == '1') {
	    var symbol = '→ ';
	  }
	  else {
	    var symbol = '* ';
	  }
      	  rep_string += '<div oncontextmenu="showAlignment(event,\''+name+'\','+j+')" class="node-element"><div class="node-name"'
      	    +'>'
      	    +symbol + ' '+DATA[name]['paps'][j]+' '
      	    +'</div><div class="node-content" style="border: 5px solid '+DATA[name]['colors'][j]+'">';
    
	  if (DATA['settings'] == 'words') {
	    rep_string += plotWord(cns.join(' '));
	  }
	  else {
	    rep_string += '';
	  }
	  rep_string += ''
      	    +'</div></div>';
      	}
	rep_string += '</div>';
      }
      else {
	var rep_string = '';
	rep_string += '<div onclick="modifyEdge(\''+name+'\');" class="node-wrap">';
	rep_string += '<div title="'+name+'" class="node-name loss"'
	  + '>'
	  + name
	  + '</div><div class="node-content">';
	rep_string += ''
	  + '</div>'
	  + '</div>';
      }
    }
    else {
      if (DATA[name]['consensus'].length > 0) {
	var rep_string = '';
      	rep_string += '<div class="leaf-wrap" name="'+name+'">';
      	for (var j=0,cns; cns=DATA[name]['consensus'][j]; j++) {
	  if (DATA[name]['retention'][j] == '1') {
	    var symbol = '→ ';
	  }
	  else {
	    var symbol = '* ';
	  }

      	  rep_string += '<div class="leaf-element"><div class="leaf-name">'
      	    +symbol + ' '+name+' ' + DATA[name]['paps'][j] + ' '
      	    +'</div><div class="leaf-content" style="color:white;border:5px solid '+DATA[name]['colors'][j]+'">';
	  if (DATA['settings'] == 'words') {
	    rep_string += plotWord(cns.join(' '));
	  }
	  else {
	    rep_string += '';
	  }
	  rep_string += ''
      	    +'</div></div>';
      	}
      	rep_string += '</div>';
      }
      else {
	var rep_string = '';
	rep_string += '<div class="leaf-wrap" style="border: 2px dotted black;">';
	rep_string += '' 
	  + '<div class="leaf-name loss">'
	  + name 
	  + '</div><div class="leaf-content">';
	rep_string += ''
	  + '</div>'
	  + '</div>';
      }
    }
    for (var j=0,child; child = children[j]; j++) {
      rep_string += '<ul><li class="node" id="E_'+child+'">{'+child+'}</li></ul>';
    }
    txt = txt.replace('{'+name+'}',rep_string);
  }
  
  /* add concept to header line */
  document.getElementById('header').innerHTML = "Lexical Evolution of &quot;"+concept+'&quot;';
  
  /* add colors */
  var col = document.getElementById('colors');
  var tmp = '';
  for (key in DATA['colors']) {
    tmp += '<div class="colors" style="background-color:'+DATA['colors'][key]+'">'
      + key
      + '</div>';
  }
  col.innerHTML = tmp;
  
  /* submit the display */
  display.innerHTML = txt; 
}

function modifyEdge(name) {
  var edge = document.getElementById('E_'+name);
  for (var i=1,child; child=edge.childNodes[i]; i++) {
    if (child.style.display == 'none') {
      child.style.display = 'block';
    }
    else {
      child.style.display = 'none';
    }
  }
}

function fakeAlert(text){
  var falert = document.createElement('div');
  falert.id = 'fake';
  var text = '<div class="message"><p>' + text + '</p>';
  text += '<div class="btn btn-primary okbutton" onclick="' + "$('#fake').remove(); document.onkeydown = function(event){basickeydown(event)};" + '")> OK </div></div>';
  falert.className = 'fake_alert';

  document.body.appendChild(falert);
  falert.innerHTML = text;
  document.onkeydown = function(event){$('#fake').remove(); document.onkeydown = function(event){basickeydown(event);};};
}

function showAlignment(event,name,idx) {
  event.preventDefault();
  var alms = DATA[name]['alignments'][idx];
  var txt = '<table>';
  for (var i=0,alm; alm=alms[i]; i++) {
    txt += '<th>'+DATA[name]['taxa'][idx][i]+'</th>';
    txt += '<td>'+plotWord(alm.join(' '),'td')+'</td></tr>';
  }
  txt += '</table>';
  fakeAlert(txt);
}


  </script>
</body>
</html>
